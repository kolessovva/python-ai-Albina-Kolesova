# Правила для поиска идей визуализации на основе данных Викиданных
# Rules for Finding Visualization Ideas from Wikidata

***

## Назначение файла

Этот файл — методические правила для систематического поиска идей визуализации
в лабораторной работе 3 курса «Python + AI» (ПетрГУ, 2026).

Правила помогают не генерировать идеи наугад, а системно исследовать
потенциал конкретного датасета.

Смежные файлы:
- task_1_sparql_guide.txt — требования к SPARQL-запросам (задание 1)
- task_2_requirements.txt — требования к ноутбуку (задание 2)

***

Правило 1. Инвентаризация полей перед генерацией идей.
Для каждого поля датасета явно определи: тип (категориальное / числовое /
текстовое / булево), заполненность (% непустых значений), мощность (сколько
уникальных значений). Разреженные поля (заполнены менее чем на 10–15%) —
не отбрасывать: именно они часто несут самый интересный сигнал
(«что объединяет эти редкие записи?»).

***

Правило 2. Матрица пар полей.
Для каждой пары полей задай вопрос: «есть ли между ними интересная зависимость?»
Систематически пройди все пары: страна × рейтинг, страна × тип объекта,
тип × год постройки, год × охранный статус и т.д.
Чем больше полей в датасете, тем богаче пространство гипотез.

***

Правило 3. Отношения «многие ко многим» → граф.
Если два объекта связаны через третий (страна — памятник — страна архитектора;
город — памятник — тип), это сигнал к построению сетевого графа.
Граф выявляет кластеры, хабы и мосты, которые никакой другой тип
визуализации не покажет.

Отдельный случай — связь через человека: если памятник → архитектор →
страна рождения архитектора, то страны оказываются связаны через архитекторов.
Это сигнал к построению двудольного графа «страна памятника — страна архитектора»,
который выявляет исторические потоки (например, итальянские архитекторы в России).

Практический совет по компоновке: для графов с более чем 40 узлами
и короткими подписями (аббревиатуры из 3 букв) использовать circular_layout
вместо spring_layout. Spring layout с полными русскими названиями нечитаем
при числе узлов больше 30; circular layout с аббревиатурами даёт карту,
где хабы (Гидра, Стрелец) видны сразу по числу рёбер.

***

Правило 4. Иерархия сложности визуализаций.
Двигаться от простого к сложному, но предлагать оба конца шкалы:
- Простые (barchart, heatmap) — быстрый результат, легко объяснить
- Средние (choropleth map, bubble chart, scatter plot, timeline / Gantt) —
  требуют подготовки данных
- Сложные (network graph, sankey diagram, bipartite graph, treemap) —
  оригинальны, впечатляют, но требуют нескольких итераций с AI

***

Правило 5. Каждая визуализация отвечает на конкретный вопрос.
Не «нарисуем барчарт по странам», а «в каких странах рейтинговая система
применяется, а в каких игнорируется?»
Формулировка вопроса помогает студенту понять, зачем строится именно
эта картинка.

***

Правило 6. Разреженные поля — не помеха, а материал для анализа.
Если поле заполнено редко (например, охранный статус — 8%,
архитекторы — 12%), это не повод его игнорировать.
Вопрос: «что общего у объектов с этим признаком?» часто даёт
самые неожиданные и интересные выводы.

***

Правило 7. Тройные связки — самый глубокий уровень.
После анализа пар полей искать тройки: страна + тип памятника + охранный статус,
архитектор + страна + тип постройки.
Тройные связки хорошо визуализируются через Sankey diagram или
трёхдольный граф. Это уровень «сильного» задания.

***

Правило 8. Учитывай специфику Викиданных.
Данные Викиданных всегда неполны и неравномерны: одни объекты описаны
подробно, другие — только QID без метки. Это не баг, а особенность.
Визуализация «насколько полно описаны объекты по полям» сама по себе
интересна и показывает тематические белые пятна в базе знаний.

***

Правило 9. Люди как связанный объект открывают отдельный класс визуализаций.
Свойства, связывающие объект с человеком (архитектор P84, основатель P112,
режиссёр P57, композитор P86 и т.п.), дают данные, недоступные при работе
только с основным объектом:
- Карты миграции: страна рождения → страна смерти
- Корреляция продолжительности жизни с типом создаваемых объектов
- География образования (в каких университетах учились)
- Гендерный анализ по эпохам или типам объектов

Для этого требуется отдельный SPARQL-файл (entity_architects.sparql или
entity_founders.sparql) и join в pandas по URI главного объекта.
Это уровень сложных визуализаций, но данные для него закладываются
уже в задании 1.

Отдельный подкласс — генеалогические визуализации (экспериментальный паттерн).
Для биологических объектов (животные, люди) свойства P22 (отец) и P25 (мать)
открывают новый уровень анализа:
- Дерево предков и потомков (networkx + graphviz)
- Передача породы через поколения (Sankey по поколениям)
- Поиск «основателей» породных линий (хабы в графе родословных)

Для этого требуется отдельный файл entity_genealogy.sparql и join
с основным датасетом по URI объекта (см. task_1_sparql_guide.txt, раздел A1).
Паттерн перспективный, но на практике до стадии визуализации
пока не проверен — возможны уточнения по мере накопления опыта.

***

Правило 10. CSV в «длинном формате» — не проблема, а ресурс.
Если CSV содержит несколько строк на один объект из-за многозначного
поля (жанры, соседи, архитекторы, языки и т.п.) — это не недостаток
запроса, а дополнительная аналитическая возможность:

- Подсчёт уникальных значений поля: сколько раз встречается жанр /
  страна / стиль — и сортировка по частоте (bar chart).
- Совместная встречаемость: какие два значения чаще всего появляются
  вместе (heatmap матрицы co-occurrence).
- Граф совместной встречаемости: объекты как вершины, совпадающие
  значения поля как рёбра (например, два объекта связаны, если у них
  одинаковый жанр или общий сосед).

Перед построением визуализации проверить: df['URL'].nunique() значительно
меньше len(df)? Если да — это «длинный формат»; схлопнуть данные через
groupby + agg, прежде чем строить графики по объектам (иначе объекты
с несколькими значениями окажутся представлены непропорционально).

***

Правило 11. Технологическая родословная → направленный граф.
Если датасет содержит поле «на основе чего создан» (P144 based on),
это сигнал к построению направленного ациклического графа (DAG):
вершины — объекты, рёбра — отношение наследования технологии или идеи.
Такой граф выявляет «корневые» изобретения и показывает, как одна
технология порождает семейство потомков. Строится через networkx.DiGraph.
Данные для него — в файле entity_lineage.sparql
(см. task_1_sparql_guide.txt, раздел A1).

***

Правило 12. Производные переменные как источник новых вопросов.
Если в данных есть площадь объекта и число связанных с ним элементов,
производная «плотность» (элементов на единицу площади) часто даёт
более интересный вопрос, чем исходные поля по отдельности.
Пример: звёзд/кв.градус выявляет созвездия-аномалии
(Золотая Рыба — LMC, Стрелец — центр Галактики), которые неочевидны
при сравнении абсолютных чисел.
Производные переменные не требуют нового SPARQL-запроса — они
вычисляются в pandas на шаге 4 задания 2.

***

## Стандарты выполнения визуализации

Этот раздел определяет обязательные технические требования к каждой
визуализации в задании 3. Применяется совместно с Правилами 1–12.

### Две/три выборки — обязательно

Для каждого графика явно формировать выборку и подписывать её:

- «Полная выборка» (df) — все строки датасета. N указывать в заголовке
  или подписи к графику.
- «Выборка по целевой метрике» — только строки, где ключевой вычисляемый
  показатель непустой. Целевая метрика — поле, ради которого строится
  этот конкретный график. Примеры: для лошадей — возраст при смерти
  (только строки, где известны и birthYear, и deathYear); для памятников —
  охранный статус (8% строк); для фильмов — бюджет или кассовые сборы.
- (Перспективный вариант) «Строки без метрики» — объекты, для которых
  целевая метрика не определена, как отдельный аналитический слой:
  «что общего у этих объектов? почему данных нет?»

Цель: никогда не допускать ситуации «рисуем по всем 12 309 записям,
но средний возраст считаем по 1 580» без явного объяснения.

### Лог-шкала при доминировании

Если одна категория или одно значение занимает бо́льшую часть графика
и остальные «прижаты к нулю» — использовать логарифмическую шкалу
по соответствующей оси. Это не украшение, а условие читаемости.

### Top-K + Other для stacked-графиков

Если категорий слишком много или одна категория занимает почти всё —
оставить топ-K наиболее значимых, остальные объединить в слой «Other».
Для сравнения долей вместо абсолютных значений — 100% stacked bar chart.

### Работа с выбросами

При обнаружении выброса обязателен один из трёх вариантов:
(а) подписать аномальную точку на графике (аннотация с именем объекта
    и значением);
(б) сделать zoom на основной диапазон с явным указанием, что отсечено;
(в) отфильтровать выброс и вывести в консоль отфильтрованные строки
    (с URL и именем объекта) с пояснением, почему.
Любой из трёх вариантов приемлем. Молча отбросить выброс — нельзя.

### Error bars и медиана

Для сравнительных барчартов рядом со средним значением указывать
стандартную ошибку среднего (sem) или медиану. Это переводит работу
из «картинок» в статистику и позволяет проверяющему оценить надёжность
вывода.

### Политика логирования Lab 3 («Политика 8 марта»)

- «Фидбек AI N: Название графика — суть правки» в текстовой ячейке
  ноутбука сразу после улучшенного графика — обязательно для всех
  студентов без исключений.
- Таблица промптов — обязательна для тех, чья дата первого коммита
  Lab 3 в GitHub позднее 08.03.2026. Для более ранних коммитов —
  по желанию.
- Публичная ссылка на беседу с DeepSeek («Share public link to thread»)
  — обязательна для всех студентов без исключений.

Подробнее о формате логирования — в tips_for_students.txt (Совет 11)
и в prompts_google_table_spec.txt (раздел 3.13).

***
